<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistente Inteligente Cadastro - Softpharma</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
            --bairro-color: #e74c3c;
            --cliente-color: #2ecc71;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: var(--primary);
            color: white;
            padding: 1.5rem;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        .chat-container {
            height: 600px;
            display: flex;
            flex-direction: column;
        }
        
        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .message {
            padding: 1rem;
            border-radius: 15px;
            max-width: 85%;
            line-height: 1.4;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            background: var(--secondary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }
        
        .bot-message {
            background: var(--light);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        
        .suggested-questions {
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            background: #f8f9fa;
        }
        
        .suggestion {
            background: white;
            border: 1px solid #dee2e6;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .suggestion.bairro {
            border-left: 4px solid var(--bairro-color);
        }
        
        .suggestion.cliente {
            border-left: 4px solid var(--cliente-color);
        }
        
        .suggestion:hover {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }
        
        .chat-input {
            display: flex;
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
            background: #f8f9fa;
        }
        
        .chat-input input {
            flex: 1;
            padding: 0.8rem 1rem;
            border: 1px solid #ddd;
            border-radius: 25px;
            outline: none;
            font-size: 0.9rem;
        }
        
        .chat-input button {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 0 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            transition: background 0.3s;
            margin-left: 0.5rem;
        }
        
        .chat-input button:hover {
            background: #2980b9;
        }
        
        .typing-indicator {
            display: none;
            padding: 1rem;
            align-self: flex-start;
        }
        
        .typing-dots {
            display: flex;
            gap: 3px;
        }
        
        .typing-dots span {
            width: 6px;
            height: 6px;
            background: #999;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }

        .path-highlight {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 0.5rem 1rem;
            margin: 0.5rem 0;
            border-radius: 0 4px 4px 0;
            font-weight: 500;
        }

        .info-box {
            background: #e1f5fe;
            border-left: 4px solid var(--secondary);
            padding: 0.8rem 1rem;
            margin: 0.5rem 0;
            border-radius: 0 4px 4px 0;
            font-size: 0.9rem;
        }

        .warning-box {
            background: #ffecb3;
            border-left: 4px solid #ffc107;
            padding: 0.8rem 1rem;
            margin: 0.5rem 0;
            border-radius: 0 4px 4px 0;
            font-size: 0.9rem;
        }

        .suggested-alternative {
            background: #e8f5e8;
            border-left: 4px solid var(--success);
            padding: 0.8rem 1rem;
            margin: 0.5rem 0;
            border-radius: 0 4px 4px 0;
            font-size: 0.9rem;
        }

        .shortcut-key {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.75rem;
            margin: 0 3px;
            font-family: monospace;
        }

        .commission-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }

        .commission-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        .module-tag {
            display: inline-block;
            background: var(--bairro-color);
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            margin-left: 8px;
            font-weight: bold;
        }

        .module-tag.cliente {
            background: var(--cliente-color);
        }

        @media (max-width: 768px) {
            .commission-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üíä Assistente Inteligente Cadastro - Softpharma</h1>
            <p>IA com reconhecimento de linguagem natural para cadastros do sistema</p>
        </div>
        
        <div class="chat-container">
            <div class="chat-messages" id="chat-messages">
                <div class="message bot-message">
                    Ol√°! Sou seu assistente inteligente para Cadastros do Softpharma. 
                    Fale comigo naturalmente - entendo perguntas informais! üòä
                </div>
            </div>
            
            <div class="suggested-questions">
                <div class="suggestion bairro" data-question="cadastrar bairro">Cadastrar bairro</div>
                <div class="suggestion cliente" data-question="cadastrar cliente">Cadastrar cliente</div>
                <div class="suggestion" data-question="como colocar dependente">Incluir dependente</div>
                <div class="suggestion" data-question="como vincular um convenio">Vincular conv√™nio</div>
                <div class="suggestion bairro" data-question="configurar comissao motoqueiro">Comiss√£o motoqueiro</div>
            </div>
            
            <div class="typing-indicator" id="typing-indicator">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            
            <div class="chat-input">
                <input type="text" id="user-input" placeholder="Ex: como cadastrar um bairro no sistema...">
                <button id="send-btn">Enviar</button>
            </div>
        </div>
    </div>

    <script>
        // DEBUG: Vamos ver EXATAMENTE o que est√° acontecendo
        console.log('=== INICIANDO SISTEMA ===');

        // M√ìDULO BAIRROS - VERIFICA√á√ÉO PRIMEIRO
        const moduloBairros = {
            name: "bairros",
            patterns: [
                // PALAVRAS-CHAVE ESPEC√çFICAS DE BAIRROS
                "bairro", "bairros", "zona", "zonas", "regi√£o", "regi√µes",
                "tele entrega", "tele-entrega", "taxa entrega", "taxa de entrega",
                "motoqueiro", "motoqueiros", "cobrador", "cobradores",
                "comiss√£o motoqueiro", "comissao motoqueiro", 
                "comiss√£o cobrador", "comissao cobrador",
                "f6", "processar lote", "processar em lote",
                "taxa tele entrega", "valor tele entrega",
                // COMBINA√á√ïES COM "cadastrar" - DEVEM VIR PRIMEIRO
                "cadastrar bairro", "cadastro bairro", "cadastro de bairros",
                "cadastrar um bairro", "novo bairro", "adicionar bairro",
                "incluir bairro", "criar bairro", "registrar bairro",
                "como cadastrar bairro", "quero cadastrar bairro",
                "preciso cadastrar bairro", "bairro farma", "bairro linx",
                "configurar bairro", "configura√ß√£o bairro"
            ],
            answer: `<strong>üìç Cadastro de Bairros - Farma/Linx <span class="module-tag">M√ìDULO BAIRROS</span></strong><br><br>
                
                <div class="path-highlight">Menu > Cadastros > Bairros</div><br>
                
                <strong>üìã DADOS DO BAIRRO (Obrigat√≥rios):</strong><br>
                ‚Ä¢ Cidade<br>
                ‚Ä¢ Estado (UF)<br>
                ‚Ä¢ Bairro<br>
                ‚Ä¢ Regi√£o (padr√£o: GERAL)<br>
                ‚Ä¢ Situa√ß√£o (ativo/inativo)<br><br>
                
                <strong>üöÄ ACESSO R√ÅPIDO:</strong><br>
                ‚Ä¢ <span class="shortcut-key">F2</span> Consulta por nome<br>
                ‚Ä¢ <span class="shortcut-key">F3</span> ou <span class="shortcut-key">ALT+N</span> Novo cadastro<br>
                ‚Ä¢ <span class="shortcut-key">F4</span> ou <span class="shortcut-key">ALT+G</span> Salvar altera√ß√µes<br>
                ‚Ä¢ <span class="shortcut-key">F5</span> ou <span class="shortcut-key">ALT+I</span> Listagem de bairros<br>
                ‚Ä¢ <span class="shortcut-key">F6</span> Processar em lote<br>
                ‚Ä¢ <span class="shortcut-key">F9</span> ou <span class="shortcut-key">ALT+E</span> Excluir cadastro<br><br>
                
                <strong>üèçÔ∏è CONFIGURA√á√ÉO DE COMISS√ïES - MOTOQUEIRO:</strong><br>
                <div class="commission-grid">
                    <div class="commission-item">
                        <strong>% Comiss√£o sobre venda</strong><br>
                        Percentual pago sobre cada venda entregue
                    </div>
                    <div class="commission-item">
                        <strong>Valor fixo na entrega</strong><br>
                        Valor fixo pago por cada entrega (R$)
                    </div>
                    <div class="commission-item">
                        <strong>% Comiss√£o transfer√™ncia</strong><br>
                        Percentual sobre transfer√™ncias entre filiais
                    </div>
                    <div class="commission-item">
                        <strong>Valor fixo transfer√™ncia</strong><br>
                        Valor fixo para entregas de transfer√™ncia (R$)
                    </div>
                </div><br>
                
                <div class="info-box">
                    <strong>üí° Dica:</strong> Use <span class="shortcut-key">F6</span> - Processar em Lote para replicar configura√ß√µes de tele entrega para v√°rios bairros de uma vez.
                </div>`
        };

        // M√ìDULO CLIENTES - VERIFICA√á√ÉO SEGUNDO
        const moduloClientes = {
            name: "clientes", 
            patterns: [
                // PALAVRAS-CHAVE ESPEC√çFICAS DE CLIENTES
                "cliente", "clientes", "pessoa", "pessoas",
                "cpf", "cnpj", "lgpd", "termo lgpd",
                "matr√≠cula", "matricula", "limite cr√©dito", "limite credito",
                // COMBINA√á√ïES COM "cadastrar" - DEVEM VIR DEPOIS DAS DE BAIRROS
                "cadastro cliente", "cadastro de clientes", "cadastrar cliente",
                "cadastrar um cliente", "novo cliente", "adicionar cliente", 
                "incluir cliente", "criar cliente", "registrar cliente",
                "como cadastrar cliente", "quero cadastrar cliente",
                "preciso cadastrar cliente", "ficha cliente"
            ],
            answer: `<strong>üë§ Cadastro de Clientes <span class="module-tag cliente">M√ìDULO CLIENTES</span></strong><br><br>
                
                <div class="path-highlight">Menu > Cadastros > Clientes > Novo</div><br>
                
                <strong>1. DADOS B√ÅSICOS (Obrigat√≥rios):</strong><br>
                ‚Ä¢ C√≥digo (autom√°tico): (Filial √ó 10.000) + Sequ√™ncia<br>
                ‚Ä¢ Nome completo<br>
                ‚Ä¢ Endere√ßo completo (CEP autocompleta)<br>
                ‚Ä¢ Contatos (telefone/celular)<br>
                ‚Ä¢ E-mails (at√© 5)<br>
                ‚Ä¢ Documentos oficiais<br>
                ‚Ä¢ Data nascimento e naturalidade<br>
                ‚Ä¢ Termo LGPD assinado<br><br>
                
                <div class="info-box"><strong>Dica:</strong> CPF/CNPJ s√≥ √© obrigat√≥rio se exigido pelo conv√™nio.</div>`
        };

        // Elementos do DOM
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const typingIndicator = document.getElementById('typing-indicator');
        const suggestions = document.querySelectorAll('.suggestion');

        // Fun√ß√£o para normalizar texto
        function normalizeText(text) {
            return text
                .toLowerCase()
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .replace(/[^\w\s]/gi, ' ');
        }

        // SISTEMA CORRIGIDO - DEBUG DETALHADO
        function findBestMatch(question) {
            const normalizedQuestion = normalizeText(question);
            console.log('=== NOVA AN√ÅLISE ===');
            console.log('üìù Pergunta original:', question);
            console.log('üîç Pergunta normalizada:', normalizedQuestion);
            
            // 1. VERIFICA√á√ÉO DETALHADA DO M√ìDULO BAIRROS
            console.log('üîé VERIFICANDO M√ìDULO BAIRROS...');
            for (let i = 0; i < moduloBairros.patterns.length; i++) {
                const pattern = moduloBairros.patterns[i];
                const normalizedPattern = normalizeText(pattern);
                
                console.log(`   Testando padr√£o ${i + 1}: "${pattern}" -> "${normalizedPattern}"`);
                
                if (normalizedQuestion.includes(normalizedPattern)) {
                    console.log(`   ‚úÖ‚úÖ‚úÖ ENCONTRADO NO M√ìDULO BAIRROS: "${pattern}"`);
                    console.log(`   ‚úÖ‚úÖ‚úÖ RETORNANDO: M√ìDULO BAIRROS`);
                    return moduloBairros.answer;
                } else {
                    console.log(`   ‚ùå N√£o encontrado: "${pattern}"`);
                }
            }
            
            // 2. VERIFICA√á√ÉO DETALHADA DO M√ìDULO CLIENTES
            console.log('üîé VERIFICANDO M√ìDULO CLIENTES...');
            for (let i = 0; i < moduloClientes.patterns.length; i++) {
                const pattern = moduloClientes.patterns[i];
                const normalizedPattern = normalizeText(pattern);
                
                console.log(`   Testando padr√£o ${i + 1}: "${pattern}" -> "${normalizedPattern}"`);
                
                if (normalizedQuestion.includes(normalizedPattern)) {
                    console.log(`   ‚úÖ‚úÖ‚úÖ ENCONTRADO NO M√ìDULO CLIENTES: "${pattern}"`);
                    console.log(`   ‚úÖ‚úÖ‚úÖ RETORNANDO: M√ìDULO CLIENTES`);
                    return moduloClientes.answer;
                } else {
                    console.log(`   ‚ùå N√£o encontrado: "${pattern}"`);
                }
            }
            
            console.log('‚ùå‚ùå‚ùå NENHUM M√ìDULO ENCONTRADO');
            return `ü§î <strong>N√£o entendi sua pergunta sobre "${question}"!</strong><br><br>
                <div class="suggested-alternative">
                <strong>Tente uma destas op√ß√µes:</strong><br><br>
                ‚Ä¢ <strong style="cursor:pointer; color: var(--bairro-color);" onclick="askQuestion('cadastrar bairro')">Cadastrar bairro</strong><br>
                ‚Ä¢ <strong style="cursor:pointer; color: var(--cliente-color);" onclick="askQuestion('cadastrar cliente')">Cadastrar cliente</strong><br>
                <em>Ou reformule sua pergunta!</em>
                </div>`;
        }

        // Fun√ß√£o para adicionar mensagem no chat
        function addMessage(message, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(isUser ? 'user-message' : 'bot-message');
            messageDiv.innerHTML = message;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Fun√ß√£o para mostrar indicador de digita√ß√£o
        function showTyping() {
            typingIndicator.style.display = 'block';
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Fun√ß√£o para esconder indicador de digita√ß√£o
        function hideTyping() {
            typingIndicator.style.display = 'none';
        }

        // Fun√ß√£o global para fazer perguntas
        window.askQuestion = function(question) {
            userInput.value = question;
            sendMessage();
        };

        // Fun√ß√£o para enviar mensagem
        function sendMessage() {
            const question = userInput.value.trim();
            if (question === '') return;
            
            addMessage(question, true);
            userInput.value = '';
            
            showTyping();
            
            setTimeout(() => {
                hideTyping();
                const answer = findBestMatch(question);
                addMessage(answer);
            }, 800);
        }

        // Event listeners
        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Sugest√µes de perguntas
        suggestions.forEach(suggestion => {
            suggestion.addEventListener('click', () => {
                const question = suggestion.getAttribute('data-question');
                userInput.value = question;
                sendMessage();
            });
        });

        // Mensagem de boas-vindas com DEBUG
        setTimeout(() => {
            addMessage(`<strong>üîß SISTEMA EM MODO DEBUG</strong><br><br>
            <strong>Teste estas frases e veja o console (F12):</strong><br>
            ‚Ä¢ "cadastrar bairro"<br>
            ‚Ä¢ "cadastrar cliente"<br>
            ‚Ä¢ "bairro"<br>
            ‚Ä¢ "cliente"<br><br>
            <em>Verifique o console do navegador para ver a an√°lise detalhada!</em>`);
            
            // Teste autom√°tico para debug
            console.log('=== TESTE AUTOM√ÅTICO ===');
            console.log('Testando "cadastrar bairro":');
            findBestMatch("cadastrar bairro");
            console.log('---');
            console.log('Testando "cadastrar cliente":');
            findBestMatch("cadastrar cliente");
        }, 1000);
    </script>
</body>
</html>
