<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Assistente Inteligente Cadastro - Softpharma</title>
    <style>
        :root {
            --primary: #2c3e50;
            --secondary: #3498db;
            --light: #ecf0f1;
            --dark: #2c3e50;
            --success: #27ae60;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 900px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        
        .header {
            background: var(--primary);
            color: white;
            padding: 1.5rem;
            text-align: center;
        }
        
        .header h1 {
            font-size: 1.5rem;
            margin-bottom: 0.5rem;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 0.9rem;
        }
        
        .chat-container {
            height: 600px;
            display: flex;
            flex-direction: column;
        }
        
        .chat-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }
        
        .message {
            padding: 1rem;
            border-radius: 15px;
            max-width: 85%;
            line-height: 1.4;
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .user-message {
            background: var(--secondary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 5px;
        }
        
        .bot-message {
            background: var(--light);
            align-self: flex-start;
            border-bottom-left-radius: 5px;
        }
        
        .suggested-questions {
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            background: #f8f9fa;
        }
        
        .suggestion {
            background: white;
            border: 1px solid #dee2e6;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .suggestion:hover {
            background: var(--secondary);
            color: white;
            border-color: var(--secondary);
        }
        
        .chat-input {
            display: flex;
            padding: 1rem 1.5rem;
            border-top: 1px solid #eee;
            background: #f8f9fa;
        }
        
        .chat-input input {
            flex: 1;
            padding: 0.8rem 1rem;
            border: 1px solid #ddd;
            border-radius: 25px;
            outline: none;
            font-size: 0.9rem;
        }
        
        .chat-input button {
            background: var(--secondary);
            color: white;
            border: none;
            padding: 0 1.5rem;
            border-radius: 25px;
            cursor: pointer;
            transition: background 0.3s;
            margin-left: 0.5rem;
        }
        
        .chat-input button:hover {
            background: #2980b9;
        }
        
        .typing-indicator {
            display: none;
            padding: 1rem;
            align-self: flex-start;
        }
        
        .typing-dots {
            display: flex;
            gap: 3px;
        }
        
        .typing-dots span {
            width: 6px;
            height: 6px;
            background: #999;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        
        .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
        .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
        
        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-5px); }
        }

        .path-highlight {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 0.5rem 1rem;
            margin: 0.5rem 0;
            border-radius: 0 4px 4px 0;
            font-weight: 500;
        }

        .info-box {
            background: #e1f5fe;
            border-left: 4px solid var(--secondary);
            padding: 0.8rem 1rem;
            margin: 0.5rem 0;
            border-radius: 0 4px 4px 0;
            font-size: 0.9rem;
        }

        .warning-box {
            background: #ffecb3;
            border-left: 4px solid #ffc107;
            padding: 0.8rem 1rem;
            margin: 0.5rem 0;
            border-radius: 0 4px 4px 0;
            font-size: 0.9rem;
        }

        .suggested-alternative {
            background: #e8f5e8;
            border-left: 4px solid var(--success);
            padding: 0.8rem 1rem;
            margin: 0.5rem 0;
            border-radius: 0 4px 4px 0;
            font-size: 0.9rem;
        }

        .shortcut-key {
            display: inline-block;
            background: var(--primary);
            color: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-size: 0.75rem;
            margin: 0 3px;
            font-family: monospace;
        }

        .commission-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 10px 0;
        }

        .commission-item {
            background: white;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }

        @media (max-width: 768px) {
            .commission-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üíä Assistente Inteligente Cadastro - Softpharma</h1>
            <p>IA com reconhecimento de linguagem natural para cadastros do sistema</p>
        </div>
        
        <div class="chat-container">
            <div class="chat-messages" id="chat-messages">
                <div class="message bot-message">
                    Ol√°! Sou seu assistente inteligente para Cadastros do Softpharma. 
                    Fale comigo naturalmente - entendo perguntas informais! üòä
                </div>
            </div>
            
            <div class="suggested-questions">
                <div class="suggestion" data-question="cadastrar bairro">Cadastrar bairro</div>
                <div class="suggestion" data-question="cadastrar cliente">Cadastrar cliente</div>
                <div class="suggestion" data-question="como colocar dependente">Incluir dependente</div>
                <div class="suggestion" data-question="como vincular um convenio">Vincular conv√™nio</div>
                <div class="suggestion" data-question="configurar comissao motoqueiro">Comiss√£o motoqueiro</div>
            </div>
            
            <div class="typing-indicator" id="typing-indicator">
                <div class="typing-dots">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
            </div>
            
            <div class="chat-input">
                <input type="text" id="user-input" placeholder="Ex: como cadastrar um bairro no sistema...">
                <button id="send-btn">Enviar</button>
            </div>
        </div>
    </div>

    <script>
        // SISTEMA COMPLETAMENTE REFEITO - Reconhecimento por combina√ß√£o exata
        const knowledgeBase = {
            "bairros": {
                patterns: [
                    // Padr√µes que devem ser verificados PRIMEIRO
                    "cadastrar bairro",
                    "cadastro bairro", 
                    "cadastrar um bairro",
                    "cadastro de bairros",
                    "novo bairro",
                    "adicionar bairro",
                    "incluir bairro",
                    "criar bairro",
                    "como cadastrar bairro",
                    "quero cadastrar bairro",
                    "preciso cadastrar bairro",
                    // Palavras individuais (verificadas por √∫ltimo)
                    "bairro",
                    "bairros",
                    "tele entrega",
                    "tele-entrega",
                    "motoqueiro",
                    "cobrador",
                    "f6",
                    "processar lote"
                ],
                answer: `<strong>üìç Cadastro de Bairros - Farma/Linx</strong><br><br>
                
                <div class="path-highlight">Menu > Cadastros > Bairros</div><br>
                
                <strong>üìã DADOS DO BAIRRO (Obrigat√≥rios):</strong><br>
                ‚Ä¢ Cidade<br>
                ‚Ä¢ Estado (UF)<br>
                ‚Ä¢ Bairro<br>
                ‚Ä¢ Regi√£o (padr√£o: GERAL)<br>
                ‚Ä¢ Situa√ß√£o (ativo/inativo)<br><br>
                
                <strong>üöÄ ACESSO R√ÅPIDO:</strong><br>
                ‚Ä¢ <span class="shortcut-key">F2</span> Consulta por nome<br>
                ‚Ä¢ <span class="shortcut-key">F3</span> ou <span class="shortcut-key">ALT+N</span> Novo cadastro<br>
                ‚Ä¢ <span class="shortcut-key">F4</span> ou <span class="shortcut-key">ALT+G</span> Salvar altera√ß√µes<br>
                ‚Ä¢ <span class="shortcut-key">F5</span> ou <span class="shortcut-key">ALT+I</span> Listagem de bairros<br>
                ‚Ä¢ <span class="shortcut-key">F6</span> Processar em lote<br>
                ‚Ä¢ <span class="shortcut-key">F9</span> ou <span class="shortcut-key">ALT+E</span> Excluir cadastro<br><br>
                
                <strong>üèçÔ∏è CONFIGURA√á√ÉO DE COMISS√ïES - MOTOQUEIRO:</strong><br>
                <div class="commission-grid">
                    <div class="commission-item">
                        <strong>% Comiss√£o sobre venda</strong><br>
                        Percentual pago sobre cada venda entregue
                    </div>
                    <div class="commission-item">
                        <strong>Valor fixo na entrega</strong><br>
                        Valor fixo pago por cada entrega (R$)
                    </div>
                    <div class="commission-item">
                        <strong>% Comiss√£o transfer√™ncia</strong><br>
                        Percentual sobre transfer√™ncias entre filiais
                    </div>
                    <div class="commission-item">
                        <strong>Valor fixo transfer√™ncia</strong><br>
                        Valor fixo para entregas de transfer√™ncia (R$)
                    </div>
                </div><br>
                
                <strong>üí∞ CONFIGURA√á√ÉO - COBRADOR:</strong><br>
                ‚Ä¢ % Comiss√£o sobre recebimento<br>
                ‚Ä¢ Valor fixo por t√≠tulo recebido<br><br>
                
                <strong>üì¶ TELE ENTREGA:</strong><br>
                ‚Ä¢ <strong>Valor √∫nico:</strong> Taxa fixa por venda<br>
                ‚Ä¢ <strong>Faixa de valores:</strong> Taxas diferenciadas por valor da compra<br>
                ‚Ä¢ <strong>Hor√°rio de venda:</strong> Taxas por per√≠odo do dia<br><br>
                
                <div class="info-box">
                    <strong>üí° Dica:</strong> Use <span class="shortcut-key">F6</span> - Processar em Lote para replicar configura√ß√µes de tele entrega para v√°rios bairros de uma vez.
                </div>
                
                <div class="warning-box">
                    <strong>‚ö†Ô∏è Aten√ß√£o:</strong> Ao cadastrar um novo bairro, os valores de comiss√µes devem ser informados, caso contr√°rio n√£o ser√° calculada a comiss√£o do motoqueiro/cobrador.
                </div>`
            },

            "clientes": {
                patterns: [
                    // Padr√µes espec√≠ficos primeiro
                    "cadastrar cliente",
                    "cadastro cliente",
                    "cadastrar um cliente", 
                    "cadastro de clientes",
                    "novo cliente",
                    "adicionar cliente",
                    "incluir cliente",
                    "criar cliente",
                    "como cadastrar cliente",
                    // Palavras individuais por √∫ltimo
                    "cliente",
                    "clientes"
                ],
                answer: `<strong>Passo a passo para cadastrar novo cliente:</strong><br><br>
                
                <div class="path-highlight">Menu > Cadastros > Clientes > Novo</div><br>
                
                <strong>1. DADOS B√ÅSICOS (Obrigat√≥rios):</strong><br>
                ‚Ä¢ C√≥digo (autom√°tico): (Filial √ó 10.000) + Sequ√™ncia<br>
                ‚Ä¢ Nome completo<br>
                ‚Ä¢ Endere√ßo completo (CEP autocompleta)<br>
                ‚Ä¢ Contatos (telefone/celular)<br>
                ‚Ä¢ E-mails (at√© 5)<br>
                ‚Ä¢ Documentos oficiais<br>
                ‚Ä¢ Data nascimento e naturalidade<br>
                ‚Ä¢ Termo LGPD assinado<br><br>
                
                <strong>2. VINCULAR CONV√äNIO (Obrigat√≥rio):</strong><br>
                ‚Ä¢ Cliente deve ter pelo menos 1 conv√™nio<br>
                ‚Ä¢ Preencher matr√≠cula (ou gerar automaticamente)<br>
                ‚Ä¢ Configurar situa√ß√£o do v√≠nculo<br>
                ‚Ä¢ Definir limite de cr√©dito se necess√°rio<br><br>
                
                <div class="info-box"><strong>Dica:</strong> CPF/CNPJ s√≥ √© obrigat√≥rio se exigido pelo conv√™nio.</div>`
            },

            "dependentes": {
                patterns: ["dependente", "dependentes", "colocar dependente", "incluir dependente"],
                answer: `<strong>Como incluir dependentes:</strong><br><br>
                
                <div class="path-highlight">Menu > Cadastros > Clientes > [Cliente] > Guia Dependentes</div><br>
                
                <strong>Dados necess√°rios:</strong><br>
                ‚Ä¢ Nome completo<br>
                ‚Ä¢ Grau de parentesco<br>
                ‚Ä¢ Telefone de contato<br>
                ‚Ä¢ Data de nascimento<br>
                ‚Ä¢ Situa√ß√£o (ativo/inativo)<br><br>
                
                <div class="warning-box"><strong>Importante:</strong> Ao inativar dependente, sistema remove automaticamente autoriza√ß√µes em conv√™nios.</div>`
            },

            "conv√™nios": {
                patterns: ["conv√™nio", "convenio", "conv√™nios", "convenios", "vincular conv√™nio"],
                answer: `<strong>Como vincular conv√™nios:</strong><br><br>
                
                <div class="path-highlight">Menu > Cadastros > Clientes > [Cliente] > Guia Conv√™nios</div><br>
                
                <strong>Passo a passo:</strong><br>
                1. Clique em <strong>"Novo"</strong> na guia Conv√™nios<br>
                2. Informe o c√≥digo do conv√™nio ou use F2 para consultar<br>
                3. Preencha a <strong>matr√≠cula</strong> (ou deixe gerar automaticamente)<br>
                4. Configure a <strong>situa√ß√£o</strong> do v√≠nculo<br>
                5. Defina <strong>limite de cr√©dito</strong> se necess√°rio<br>
                6. Clique em <strong>"Aplicar"</strong> para salvar<br><br>
                
                <div class="info-box"><strong>Lembrete:</strong> Todo cliente precisa ter pelo menos 1 conv√™nio vinculado!</div>`
            },

            "default": {
                patterns: [],
                answer: `ü§î <strong>Entendi que voc√™ quer ajuda com cadastros!</strong><br><br>
                
                <div class="suggested-alternative">
                <strong>Baseado na sua pergunta, talvez voc√™ queira saber sobre:</strong><br><br>
                
                ‚Ä¢ <strong style="cursor:pointer; color: var(--secondary);" onclick="askQuestion('cadastrar bairro')">Como cadastrar bairros</strong><br>
                ‚Ä¢ <strong style="cursor:pointer; color: var(--secondary);" onclick="askQuestion('cadastrar cliente')">Como cadastrar um novo cliente</strong><br>
                ‚Ä¢ <strong style="cursor:pointer; color: var(--secondary);" onclick="askQuestion('como colocar dependente')">Como incluir dependentes</strong><br>
                ‚Ä¢ <strong style="cursor:pointer; color: var(--secondary);" onclick="askQuestion('como vincular um convenio')">Como vincular conv√™nios</strong><br>
                ‚Ä¢ <strong style="cursor:pointer; color: var(--secondary);" onclick="askQuestion('configurar comissao motoqueiro')">Como configurar comiss√µes</strong><br><br>
                
                <em>Clique em uma das op√ß√µes acima ou reformule sua pergunta!</em>
                </div>`
            }
        };

        // Elementos do DOM
        const chatMessages = document.getElementById('chat-messages');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const typingIndicator = document.getElementById('typing-indicator');
        const suggestions = document.querySelectorAll('.suggestion');

        // Fun√ß√£o para normalizar texto
        function normalizeText(text) {
            return text
                .toLowerCase()
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '')
                .replace(/[^\w\s]/gi, ' ');
        }

        // SISTEMA CORRIGIDO - Verifica combina√ß√µes EXATAS primeiro
        function findBestMatch(question) {
            const normalizedQuestion = normalizeText(question);
            console.log('üîç Analisando:', normalizedQuestion);
            
            // PRIMEIRO: Verifica combina√ß√µes EXATAS em BAIRROS
            for (const pattern of knowledgeBase.bairros.patterns) {
                const normalizedPattern = normalizeText(pattern);
                // Verifica se o padr√£o completo est√° na pergunta
                if (normalizedQuestion.includes(normalizedPattern)) {
                    console.log('‚úÖ ENCONTROU BAIRRO (padr√£o exato):', normalizedPattern);
                    return "bairros";
                }
            }
            
            // SEGUNDO: Verifica combina√ß√µes EXATAS em CLIENTES
            for (const pattern of knowledgeBase.clientes.patterns) {
                const normalizedPattern = normalizeText(pattern);
                if (normalizedQuestion.includes(normalizedPattern)) {
                    console.log('‚úÖ ENCONTROU CLIENTE (padr√£o exato):', normalizedPattern);
                    return "clientes";
                }
            }
            
            // TERCEIRO: Verifica palavras individuais em BAIRROS
            const words = normalizedQuestion.split(/\s+/);
            for (const word of words) {
                for (const pattern of knowledgeBase.bairros.patterns) {
                    const normalizedPattern = normalizeText(pattern);
                    // Verifica se √© uma palavra individual (n√£o combina√ß√£o)
                    if (normalizedPattern.split(' ').length === 1 && word === normalizedPattern) {
                        console.log('‚úÖ ENCONTROU BAIRRO (palavra individual):', word);
                        return "bairros";
                    }
                }
            }
            
            // QUARTO: Verifica palavras individuais em CLIENTES
            for (const word of words) {
                for (const pattern of knowledgeBase.clientes.patterns) {
                    const normalizedPattern = normalizeText(pattern);
                    if (normalizedPattern.split(' ').length === 1 && word === normalizedPattern) {
                        console.log('‚úÖ ENCONTROU CLIENTE (palavra individual):', word);
                        return "clientes";
                    }
                }
            }
            
            // QUINTO: Verifica outras categorias
            for (const [category, data] of Object.entries(knowledgeBase)) {
                if (category === "bairros" || category === "clientes" || category === "default") continue;
                
                for (const pattern of data.patterns) {
                    const normalizedPattern = normalizeText(pattern);
                    if (normalizedQuestion.includes(normalizedPattern)) {
                        console.log('‚úÖ ENCONTROU', category.toUpperCase(), ':', normalizedPattern);
                        return category;
                    }
                }
            }
            
            console.log('‚ùå Nenhuma correspond√™ncia, usando default');
            return "default";
        }

        // Fun√ß√£o para adicionar mensagem no chat
        function addMessage(message, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(isUser ? 'user-message' : 'bot-message');
            messageDiv.innerHTML = message;
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Fun√ß√£o para mostrar indicador de digita√ß√£o
        function showTyping() {
            typingIndicator.style.display = 'block';
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Fun√ß√£o para esconder indicador de digita√ß√£o
        function hideTyping() {
            typingIndicator.style.display = 'none';
        }

        // Fun√ß√£o para processar a pergunta do usu√°rio
        function processQuestion(question) {
            const bestMatch = findBestMatch(question);
            return knowledgeBase[bestMatch].answer;
        }

        // Fun√ß√£o global para fazer perguntas
        window.askQuestion = function(question) {
            userInput.value = question;
            sendMessage();
        };

        // Fun√ß√£o para enviar mensagem
        function sendMessage() {
            const question = userInput.value.trim();
            if (question === '') return;
            
            addMessage(question, true);
            userInput.value = '';
            
            showTyping();
            
            setTimeout(() => {
                hideTyping();
                const answer = processQuestion(question);
                addMessage(answer);
            }, 800);
        }

        // Event listeners
        sendBtn.addEventListener('click', sendMessage);
        userInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });

        // Sugest√µes de perguntas
        suggestions.forEach(suggestion => {
            suggestion.addEventListener('click', () => {
                const question = suggestion.getAttribute('data-question');
                userInput.value = question;
                sendMessage();
            });
        });

    </script>
</body>
</html>
